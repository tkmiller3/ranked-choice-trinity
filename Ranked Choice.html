<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Trinity Ranked Voting App</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        $(function(){
            function handleFileSelect(evt) {
                evt.stopPropagation();
                evt.preventDefault();
        
                let file = evt.dataTransfer.files[0]; // First FileList object
        
                // clear out the old results
                $("#numRows").text("");
                $("#numCols").text("");
        
                $("#fileName").text(file.name);
        
                if (!/\.csv$/i.test(file.name)) {
                alert("Please give me a CSV file!");
                return;
                }
        
                Papa.parse(file, {
                complete: function (results) {
                    if (results.errors.length != 0) {
                    alert(
                        "I was not able to parse this file. Are you sure it's CSV?"
                    );
                    } else {
                    processData(results.data);
                    }
                },
            });
          }
    
          ////////////////////// drag and drop stuff //////////////////////
    
          function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = "copy"; // Explicitly show this is a copy.
          }
    
          // Setup the dnd listeners.
    
          let dropZone = document.getElementById("drop_zone");
          dropZone.addEventListener("dragover", handleDragOver, false);
          dropZone.addEventListener("drop", handleFileSelect, false);
        });
    </script>
    <script src='rankedVote.js'></script>
    <style>
      body {
        font-family: sans-serif;
      }
      li {
        padding-top: 5px;
      }
      #drop_zone {
        border: 2px dashed #bbb;
        -moz-border-radius: 10px;
        -webkit-border-radius: 10px;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        font: bold italic 20pt;
        color: #bbb;
      }
    </style>
  </head>

  <body>
    <h2 style="text-align: center">
      <i>Trinity House Points Bonus Voting App</i>
    </h2>
    <div id="drop_zone">Drop CSV ballots file here...</div>
    <div id="results">
      <h3>Results</h3>
      <h4>Aggregate Data</h4>
      <ul>
        <li>File: <span id="fileName"></span></li>
        <li>Rows: <span id="numRows"></span></li>
        <li>Columns: <span id="numCols"></span></li>
      </ul>
      <h4>Team Results (in rank order)</h4>
      <ul id="teamList"></ul>
    </div>

  </body>
</html>
